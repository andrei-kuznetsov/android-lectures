# Лабораторная работа №6. Многопоточные Android приложения.

## Цели
Получить практические навыки разработки многопоточных приложений:
1. Организация обработки длительных операций в background (worker) thread:
    * Запуск фоновой операции (Coroutine/ExecutionService/Thread)
    * Остановка фоновой операции (Coroutine/ExecutionService/Thread)
1. Публикация данных из background (worker) thread в main (ui) thread.

Освоить 3 основные группы API для разработки многопоточных приложений:
1. Kotlin Coroutines
1. ExecutionService
1. Java Threads

## Задачи
### Задача 1. Альтернативные решения задачи "не секундомер" из Лаб. 2
Используйте приложение "не секундомер", получившееся в результате выполнения [Лабораторной работы №2](../02/TASK.md). Разработайте несколько альтернативных приложений "не секундомер", отличающихся друг от друга организацией многопоточной работы. Опишите все известные Вам решения.

#### Указания
К моменту выполнения работы Вам должно быть известно, как минимум, 4 принципиально разных подхода к решению задачи. В отчете должны появиться, как минимум, 3 решения:
1. С помощью Java Threads (фактически, это оригинальный код, однако на этот раз необходимо убедиться, что потоки запускаются и останавливаются в определенные моменты времени. Опишите эти моменты времени в отчете. Обратите внимание, что потоки не должны существовать, когда приложение не отображается на экране).
1. С помощью [ExecutionService](https://developer.android.com/guide/background/threading). Это та же программа, что и в предыдущем пункте, только в этой версии программы потоки не будут создаваться вручную. Потоки могут существовать, когда приложение находится в background, однако нужно убедиться, что этот поток ничего не делает.
1. С помощью [Kotlin Coroutines](https://developer.android.com/kotlin/coroutines). В качестве знакомства с корутинами рекомендуется выполнить шаги 1-6 (включительно) из codelab: https://codelabs.developers.google.com/codelabs/kotlin-coroutines

Во всех случаях необходимо обращать внимание на то, когда запускаются потоки/задачи и когда они останавливаются: приложение не должно тратить впустую ресурсы ОС, когда оно не отображается на экране.

Как и в любом другом приложении, необходимо уделить особое внимание поведению приложения в ситуации перезапуска Activity (например, в результате поворота экрана). Не должно появляться более одного активного потока/задачи для подсчета времени.

Также можно улучшить точность подсчета времени. `sleep(1000)` не гарантирует остановку потока *ровно* на 1000 мс. Подумайте, как избавиться от накапливающейся ошибки. Для улучшения мыслительного процесса поменяйте `sleep(1000)` на `sleep(Random.nextInt(2000))`, чтобы не возникало ложного ощущения, что число `1000` можно скорректировать на какое-либо количество миллисекунд.

### Задача 2. Загрузка картинки в фоновом потоке
Создайте приложение, которое скачивает картинку из интернета и размещает ее в `ImageView` в `Activity`. Используйте `ExecutorService` для решения этой задачи. Пример закачки картинки:
```java
URL newurl = new URL(photo_url_str); 
mIcon_val = BitmapFactory.decodeStream(newurl.openConnection().getInputStream());
profile_photo.setImageBitmap(mIcon_val);
```

### Задача 3. Загрузка картинки в фоновом потоке (Kotlin Coroutines) 
Перепишите предыдущее приложение с использованием Kotlin Coroutines.

### Задача 4. Использование сторонних библиотек 
Многие "стандартные" задачи имеют "стандартные" решения. Задача скачивания изображения в фоне возникает настолько часто, что уже сравнительно давно решение этой задачи занимает всего лишь несколько строчек. Убедитесь в этом на примере одной (любой) библиотеки [Glide](https://github.com/bumptech/glide#how-do-i-use-glide), [picasso](https://square.github.io/picasso/) или [fresco](https://frescolib.org/docs/index.html).

### Задача 5* (по желанию). Using Kotlin Coroutines Codelab 
Выполните все шаги codelab https://codelabs.developers.google.com/codelabs/kotlin-coroutines

Результаты выполнения этого задания не обязательно отображать в отчёте. Выполнение этого задания не влияет на аттестацию.


# Общие Рекомендации


## Отчет  
Отчет должен содержать формулировку целей, решения задач с ответами на дополнительные вопросы из раздела «указания», выводы. Выводы должны содержать:
1. информацию о том, как достигается каждая из задач в разных группах API: запуск фоновой задачи, остановка фоновой задачи, передача данных из фонового потока в UI поток;
2. любую дополнительную уместную информацию на усмотрение студента;

## Дополнительные файлы

1. Отчёт или сопроводительное письмо должны содержать ссылку на полный проект с решением всех задач, кроме codelabs (или несколько проектов), который можно загрузить в Android Studio.

## Статистика (по желанию)
В отчете укажите примерное время решения каждой из предложенных задач, включая время ознакомления со справочными материалами (время решения не влияет на оценку: только на анонимный сбор статистики для корректировки сложности задач в будущем).

# Вспомогательные материалы
## Основные
1. https://developer.android.com/kotlin/coroutines
1. http://developer.android.com/reference/android/os/AsyncTask.html
1. https://developer.android.com/reference/java/lang/Thread

## Дополнительные
1. http://developer.alexanderklimov.ru/android/theory/asynctask.php
1. https://github.com/Kotlin/KEEP/blob/master/proposals/coroutines.md
